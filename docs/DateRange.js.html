<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" charset="utf-8">
    <title>dateutils</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/cayman.min.css">
    <link rel="stylesheet" href="css/prism.min.css">
    <link rel="stylesheet" href="css/index.min.css">
    <link rel="stylesheet" href="css/docs.min.css">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
  </head>
  <body data-spy="scroll" data-target=".scrollspy">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a class="brand">Mr. Doc</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right sponsored"></ul>
          </div>
        </div>
      </div>
    </div>
    <header id="overview" class="jumbotron subhead">
      <div class="container">
        <h1>dateutils</h1>
        <p class="lead"></p>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="span3 bs-docs-sidebar">
          <ul class="nav nav-list bs-docs-sidenav affix-top">
            <li><a>Main</a></li>
            <li><a>DateFormat.js</a></li>
            <li><a>DateLocale.js</a></li>
            <li><a>DateParse.js</a></li>
            <li class="active"><a>DateRange.js</a></li>
            <li><a>DateTime.js</a></li>
            <li><a>Duration.js</a></li>
            <li><a>index.js</a></li>
            <li><a>locale/AU.js</a></li>
            <li><a>locale/DE.js</a></li>
            <li><a>locale/EN.js</a></li>
            <li><a>locale/ET.js</a></li>
            <li><a>locale/FI-holidays.js</a></li>
            <li><a>locale/FI.js</a></li>
            <li><a>locale/FR.js</a></li>
            <li><a>locale/LV.js</a></li>
            <li><a>locale/RU.js</a></li>
            <li><a>locale/SV.js</a></li>
          </ul>
          <div class="scrollspy">
            <ul class="nav nav-list bs-docs-sidenav affix-top">
              <li><a href="#DateTime"><i class="alert alert-success"></i><span>DateTime</span></a>
              </li>
            </ul>
          </div>
        </div>
        <div class="span9">
          <section id="DateTime">
            <h1>DateTime</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-success radius ctx-type">declaration</div><span>&nbsp;</span><span>DateTime</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"></div>
          <pre><code class="language-javascript">var DateTime = require('./DateTime')
var DateFormat = require('./DateFormat')
var DateParse = require('./DateParse')

function DateRange(date1, date2) {
  if (!date1 || !date2) {
    throw('two dates must be specified, date1=' + date1 + ', date2=' + date2)
  }
  this.start = (date1.compareTo(date2) &gt; 0 ? date2 : date1)
  this.end = (date1.compareTo(date2) &gt; 0 ? date1 : date2)
  this._days = 0
  this._hours = 0
  this._minutes = 0
  this._valid = true
}

DateRange.emptyRange = function () {
  function NullDateRange() {
    this.start = null
    this.end = null
    this.days = function () {
      return 0
    }
    this.shiftDays = function () {}
    this.hasDate = function () { return false }
    this.clone = function () { return DateRange.emptyRange() }
    this.expandDaysTo = function () { return this }
    this.hasEndsOnWeekend = function () { return false }
    this.isPermittedRange = function () { return true }
    this.hasSelection = function () { return false }
  }

  return new NullDateRange()
}

DateRange.rangeWithMinimumSize = function (oldRange, minimumSize, disableWeekends, outerRange) {
  if (isTooSmallSelection()) {
    var newRange = oldRange.expandDaysTo(minimumSize)
    if (disableWeekends &amp;&amp; newRange.hasEndsOnWeekend()) {
      var shiftedDays = newRange.shiftDays(delta(newRange.end.getDay())).shiftInside(outerRange)
      while (!shiftedDays.isPermittedRange(minimumSize, disableWeekends, outerRange) || shiftedDays.end.compareTo(outerRange.end) &gt; 0) {
        if (!shiftedDays.isPermittedRange(minimumSize, false, outerRange)) {
          return DateRange.emptyRange()
        }
        shiftedDays = shiftedDays.shiftDays(1)
      }
      newRange = shiftedDays
    }
    if (!newRange.isPermittedRange(minimumSize, false, outerRange)) {
      return DateRange.emptyRange()
    }
    return newRange
  }
  return oldRange

  function isTooSmallSelection() { return minimumSize &amp;&amp; oldRange.days() &lt;= minimumSize }

  function delta(x) { return -((x + 1) % 7 + 1) }
}

DateRange.prototype._setDaysHoursAndMinutes = function () {
  if (this._hasTimes) {
    var ms = parseInt((this.end.getTime() - this.start.getTime()), 10)
    this._days = parseInt(ms / DateTime.DAY, 10)
    ms = ms - (this._days * DateTime.DAY)
    this._hours = parseInt(ms / DateTime.HOUR, 10)
    ms = ms - (this._hours * DateTime.HOUR)
    this._minutes = parseInt(ms / DateTime.MINUTE, 10)
  }
}

DateRange.prototype._dateWithTime = function (dateWithoutTime, parsedTime) { return dateWithoutTime.withTime(parsedTime[0], parsedTime[1]) }

DateRange.prototype.hours = function () { return this._hours }

DateRange.prototype.minutes = function () { return this._minutes }

DateRange.prototype.hasDate = function (date) { return date.isBetweenDates(this.start, this.end) }

DateRange.prototype.isValid = function () { return this._valid &amp;&amp; this.end.getTime() - this.start.getTime() &gt;= 0 }

DateRange.prototype.days = function () { return this._hasTimes ? this._days : Math.round(this.start.distanceInDays(this.end) + 1) }

DateRange.prototype.shiftDays = function (days) { return new DateRange(this.start.plusDays(days), this.end.plusDays(days)) }

DateRange.prototype.expandTo = function (date) {
  var newStart = this.start.clone()
  var newEnd = this.end.clone()
  if (date.compareTo(this.start) &lt; 0) newStart = date
  else if (date.compareTo(this.end) &gt; 0) newEnd = date
  return new DateRange(newStart, newEnd)
}

DateRange.prototype.expandDaysTo = function (days) { return new DateRange(this.start, this.start.plusDays(days - 1)) }

DateRange.prototype.hasValidSize = function (minimumDays) { return minimumDays &lt; 0 || this.days() &gt;= minimumDays }

DateRange.prototype.hasValidSizeAndEndsOnWorkWeek = function (minimumDays) {
  return this.hasValidSize(minimumDays) &amp;&amp; this.hasEndsOnWeekend()
}

DateRange.prototype.and = function (that) {
  var latestStart = this.start.compareTo(that.start) &gt; 0 ? this.start : that.start
  var earliestEnd = this.end.compareTo(that.end) &gt; 0 ? that.end : this.end
  return latestStart.compareTo(earliestEnd) &lt; 0 ? new DateRange(latestStart, earliestEnd) : DateRange.emptyRange()
}

DateRange.prototype.isInside = function (outer) {
  return this.start.compareTo(outer.start) &gt;= 0 &amp;&amp; this.end.compareTo(outer.end) &lt;= 0
}

DateRange.prototype.hasEndsOnWeekend = function () { return this.start.isWeekend() || this.end.isWeekend() }

DateRange.prototype.withTimes = function (startTimeStr, endTimeStr) {
  var parsedStartTime = DateParse.parseTime(startTimeStr)
  var parsedEndTime = DateParse.parseTime(endTimeStr)
  var rangeWithTimes = this.clone()
  if (parsedStartTime &amp;&amp; parsedEndTime) {
    rangeWithTimes._valid = true
    rangeWithTimes._hasTimes = true
    rangeWithTimes.start = this._dateWithTime(this.start, parsedStartTime)
    rangeWithTimes.end = this._dateWithTime(this.end, parsedEndTime)
    rangeWithTimes._setDaysHoursAndMinutes()
  } else {
    rangeWithTimes._valid = false
  }
  return rangeWithTimes
}

DateRange.prototype.clone = function () { return new DateRange(this.start, this.end) }

DateRange.prototype.toString = function () {
  return [
    'DateRange:',
    this.start.toString(),
    '-',
    this.end.toString(),
    this._days,
    'days',
    this._hours,
    'hours',
    this._minutes,
    'minutes',
    this._valid ? 'valid' : 'invalid'
  ].join(' ')
}

DateRange.prototype.isPermittedRange = function (minimumSize, disableWeekends, outerRange) {
  return this.hasValidSize(minimumSize) &amp;&amp; (!(disableWeekends &amp;&amp; this.hasEndsOnWeekend())) &amp;&amp; this.isInside(outerRange)
}

DateRange.prototype.shiftInside = function (outerRange) {
  if (this.days() &gt; outerRange.days()) {
    return DateRange.emptyRange()
  }
  var distanceToOuterRangeStart = this.start.distanceInDays(outerRange.start)
  var distanceToOuterRangeEnd = this.end.distanceInDays(outerRange.end)
  if (distanceToOuterRangeStart &gt; 0) {
    return this.shiftDays(distanceToOuterRangeStart)
  }
  if (distanceToOuterRangeEnd &lt; 0) {
    return this.shiftDays(distanceToOuterRangeEnd)
  }
  return this
}

DateRange.prototype.hasSelection = function () {
  return this.days() &gt; 0
}

module.exports = DateRange</code></pre>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Documentation generated with <a href="https://github.com/mr-doc/mr-doc">Mr. Doc </a> created by <a href="https://twitter.com/FGRibreau" data-show-count="false" class="twitter-follow-button">Francois-Guillaume Ribreau </a></p>
        <p>Mr. Doc is sponsored by <a href="http://bringr.net/?btt" title="Outil d'analyse des rÃ©seaux sociaux" class="bringr">Bringr </a> and <a href="https://redsmin.com/?btt" title="Full Redis GUI" class="redsmin">Redsmin</a></p>
        <p>Theme borrowed from Twitter Bootstrap</p>
      </div>
    </footer>
    <script src="js/twitter-widget.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap-transition.min.js"></script>
    <script src="js/bootstrap-scrollspy.min.js"></script>
    <script src="js/bootstrap-dropdown.min.js"></script>
    <script src="js/bootstrap-collapse.min.js"></script>
    <script src="js/bootstrap-affix.min.js"></script>
    <script src="js/prism.min.js"></script>
    <script src="js/index.min.js"></script>
  </body>
</html>